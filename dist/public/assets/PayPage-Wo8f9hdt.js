import{r as c,j as e}from"./react-vendor-DXh2JWUH.js";import{C as m,B as d}from"./card-l8B5EJfV.js";import{I as q}from"./input-BK4KRhIb.js";import{T as ce}from"./textarea-CiUoc1B0.js";import{u as ie}from"./index-XvOZlhht.js";import{b as oe,A as xe,a as I,Z as me,C as ue,j as he,k as pe,I as Q,F as X,l as _,X as fe}from"./icons-vendor-BKMeapAd.js";import"./ui-extended-CLSNRB24.js";import"./ui-core-DuOrk3UI.js";import"./utils-vendor-B2rm_Apj.js";import"./react-query-DV86JtqI.js";function Fe({exchangeRate:N,availableUsdt:H,onBack:L,onSubmit:J,draft:n,onDraftChange:A}){var Z;const{toast:f}=ie(),[a,j]=c.useState((n==null?void 0:n.step)||1),[C,K]=c.useState(((Z=n==null?void 0:n.amountRub)==null?void 0:Z.toString())||""),[u,E]=c.useState((n==null?void 0:n.frozenRate)||0),[i,P]=c.useState((n==null?void 0:n.urgency)||"standard"),[o,b]=c.useState((n==null?void 0:n.attachments)||[]),[y,O]=c.useState((n==null?void 0:n.comment)||""),[S,B]=c.useState(""),$=c.useRef(null),W=c.useRef(null),G=c.useRef(null);c.useEffect(()=>{a===1&&u===0&&E(N)},[a,N,u]);const F=H*N,l=Number(C),w=u>0?u:N,M=l/w,V=i==="urgent"?M*1.005:M,h=Number(V.toFixed(8)),R=l>0&&l<3e3,U=l>1e5,k=l>F;c.useEffect(()=>{a>=1&&a<=4&&A({step:a,amountRub:l,amountUsdt:h,frozenRate:u||N,urgency:i,hasUrgentFee:i==="urgent",attachments:o,comment:y})},[a,l,h,u,i,o,y]);const z=()=>{if(a===1)l>=3e3&&l<=1e5&&!k&&(E(N),j(2));else if(a===2)j(3);else if(a===3){if(o.length===0){f({title:"Необходимо прикрепить данные",description:"Прикрепите минимум 1 фото, файл или ссылку для оплаты",variant:"destructive"});return}j(4)}},v=()=>{a===1?(A(null),L()):a===2?j(1):a===3?j(2):a===4&&j(3)},Y=()=>{J({step:5,amountRub:l,amountUsdt:h,frozenRate:u,urgency:i,hasUrgentFee:i==="urgent",attachments:o,comment:y}),j(5)},T=s=>new Promise((t,x)=>{const r=new FileReader;r.onload=()=>{typeof r.result=="string"?t(r.result):x(new Error("Failed to convert file to base64"))},r.onerror=()=>x(r.error),r.readAsDataURL(s)}),ee=()=>{var s;(s=$.current)==null||s.click()},se=()=>{var s;(s=W.current)==null||s.click()},te=()=>{var s;(s=G.current)==null||s.click()},ae=async s=>{var r;const t=(r=s.target.files)==null?void 0:r[0];if(!t)return;const x=5*1024*1024;if(t.size>x){f({title:"Файл слишком большой",description:"Максимальный размер файла — 5 МБ",variant:"destructive"});return}try{const p=await T(t);b([...o,{type:"image",value:p,name:t.name}]),s.target.value=""}catch{f({title:"Ошибка",description:"Не удалось обработать фото",variant:"destructive"})}},ne=async s=>{var r;const t=(r=s.target.files)==null?void 0:r[0];if(!t)return;const x=5*1024*1024;if(t.size>x){f({title:"Файл слишком большой",description:"Максимальный размер файла — 5 МБ",variant:"destructive"});return}try{const p=await T(t);b([...o,{type:"image",value:p,name:t.name}]),s.target.value=""}catch{f({title:"Ошибка",description:"Не удалось загрузить фото",variant:"destructive"})}},le=async s=>{var r;const t=(r=s.target.files)==null?void 0:r[0];if(!t)return;const x=5*1024*1024;if(t.size>x){f({title:"Файл слишком большой",description:"Максимальный размер файла — 5 МБ",variant:"destructive"});return}try{const p=await T(t);let g="pdf";const D=t.name.toLowerCase();D.endsWith(".doc")?g="doc":D.endsWith(".docx")?g="docx":D.endsWith(".pdf")?g="pdf":t.type==="application/msword"?g="doc":t.type==="application/vnd.openxmlformats-officedocument.wordprocessingml.document"&&(g="docx"),b([...o,{type:g,value:p,name:t.name}]),s.target.value=""}catch{f({title:"Ошибка",description:"Не удалось загрузить документ",variant:"destructive"})}},re=()=>{S.trim()&&(b([...o,{type:"link",value:S.trim()}]),B(""))},de=s=>{b(o.filter((t,x)=>x!==s))};return a===5?e.jsx("div",{className:"flex flex-col items-center justify-center min-h-[calc(100vh-4rem)] px-4 pb-24",children:e.jsxs("div",{className:"max-w-md w-full text-center space-y-6",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"w-20 h-20 rounded-full bg-green-100 flex items-center justify-center",children:e.jsx(oe,{className:"w-10 h-10 text-green-600"})})}),e.jsxs(m,{className:"p-8 space-y-4 shadow-soft rounded-2xl text-left",children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground text-center",children:"Заявка отправлена"}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsx("p",{className:"text-muted-foreground",children:"Спасибо! Мы получили вашу заявку и постараемся оплатить её как можно скорее."}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Сумма:"})," ",e.jsxs("span",{className:"font-semibold",children:[l.toLocaleString("ru-RU")," ₽"]})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Заморозили на балансе:"})," ",e.jsxs("span",{className:"font-semibold",children:[h.toFixed(2)," USDT"]})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Статус:"})," ",e.jsx("span",{className:"font-semibold text-blue-600",children:"ОТПРАВЛЕНА"})]})]})]})]}),e.jsx(d,{onClick:L,className:"w-full rounded-xl",size:"lg","data-testid":"button-back-to-dashboard",children:"Вернуться на главную страницу"})]})}):e.jsx("div",{className:"flex flex-col min-h-[calc(100vh-4rem)] px-4 pt-6 pb-24 bg-background",children:e.jsxs("div",{className:"max-w-md w-full mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(d,{variant:"ghost",onClick:v,className:"gap-2 -ml-2","data-testid":"button-back",children:[e.jsx(xe,{className:"w-4 h-4"}),"Назад"]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Шаг ",a,"/4"]})]}),a===1&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground mb-2",children:"Укажите сумму в ₽"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Ваш баланс в рублях: ",e.jsxs("span",{className:"font-semibold text-foreground",children:[F.toLocaleString("ru-RU",{maximumFractionDigits:0})," ₽"]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(q,{type:"number",placeholder:"Например, 2 500",value:C,onChange:s=>K(s.target.value),className:"text-2xl h-16 text-center font-semibold rounded-xl","data-testid":"input-amount-rub"}),u>0&&e.jsxs("p",{className:"text-center text-xs text-muted-foreground",children:["Зафиксированный курс: ",w.toFixed(2)," ₽"]}),l>0&&!R&&!U&&!k&&e.jsxs("div",{className:"text-center space-y-1",children:[e.jsxs("p",{className:"text-sm text-muted-foreground","data-testid":"text-usdt-equivalent",children:["≈ ",h.toFixed(2)," USDT"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Будет заморожено: ",h.toFixed(2)," USDT"]})]}),R&&e.jsx(m,{className:"p-4 bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800 rounded-xl",children:e.jsxs("div",{className:"flex gap-2 items-start",children:[e.jsx(I,{className:"w-5 h-5 text-red-600 dark:text-red-400 shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm text-red-700 dark:text-red-300",children:"Минимальная сумма — 3 000 ₽."})]})}),U&&e.jsx(m,{className:"p-4 bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800 rounded-xl",children:e.jsxs("div",{className:"flex gap-2 items-start",children:[e.jsx(I,{className:"w-5 h-5 text-red-600 dark:text-red-400 shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm text-red-700 dark:text-red-300",children:"Максимальная сумма — 100 000 ₽."})]})}),k&&!R&&!U&&e.jsx(m,{className:"p-4 bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800 rounded-xl",children:e.jsxs("div",{className:"flex gap-2 items-start",children:[e.jsx(I,{className:"w-5 h-5 text-red-600 dark:text-red-400 shrink-0 mt-0.5"}),e.jsxs("p",{className:"text-sm text-red-700 dark:text-red-300",children:["Недостаточно средств. Доступно: ",e.jsxs("span",{className:"font-semibold",children:[F.toLocaleString("ru-RU",{maximumFractionDigits:0})," ₽"]}),". Пополните баланс или уменьшите сумму."]})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(d,{onClick:v,variant:"outline",className:"flex-1 rounded-xl",children:"Отмена"}),e.jsx(d,{onClick:z,className:"flex-1 rounded-xl",disabled:!C||l<3e3||l>1e5||k,"data-testid":"button-next-step",children:"Далее"})]})]})]}),a===2&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Выберите срочность обработки"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-3",children:[e.jsx(m,{className:`p-5 cursor-pointer transition-soft rounded-2xl shadow-soft hover-lift ${i==="urgent"?"bg-white border-2 border-primary":"bg-muted/30"}`,onClick:()=>P("urgent"),"data-testid":"card-urgency-urgent",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-yellow-100 flex items-center justify-center shrink-0",children:e.jsx(me,{className:"w-6 h-6 text-yellow-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-foreground text-lg",children:"⚡ Срочно (5–10 минут)"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Комиссия +0,5%."})]})]})}),e.jsx(m,{className:`p-5 cursor-pointer transition-soft rounded-2xl shadow-soft hover-lift ${i==="standard"?"bg-white border-2 border-primary":"bg-muted/30"}`,onClick:()=>P("standard"),"data-testid":"card-urgency-standard",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center shrink-0",children:e.jsx(ue,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-foreground text-lg",children:"⏱️ Стандартно (10–30 минут)"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Без комиссии."})]})]})})]}),e.jsxs(m,{className:"p-4 bg-primary/5 border-primary/20 rounded-xl",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Будет заморожено:"}),e.jsxs("p",{className:"text-2xl font-bold text-foreground",children:[h.toFixed(2)," USDT"]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Зафиксированный курс: ",w.toFixed(2)," ₽"]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(d,{onClick:v,variant:"outline",className:"flex-1 rounded-xl",children:"Назад"}),e.jsx(d,{onClick:z,className:"flex-1 rounded-xl","data-testid":"button-next-step",children:"Далее"})]})]})]}),a===3&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Прикрепите QR-код, ссылку или PDF-документ со счётом на оплату"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[e.jsx("span",{className:"text-red-500",children:"*"})," Обязательно прикрепить минимум 1 файл или ссылку"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{ref:$,type:"file",accept:"image/*",capture:"environment",onChange:ae,className:"hidden"}),e.jsx("input",{ref:W,type:"file",accept:"image/*",onChange:ne,className:"hidden"}),e.jsx("input",{ref:G,type:"file",accept:".pdf,.doc,.docx",onChange:le,className:"hidden"}),e.jsxs(m,{className:"p-4 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(he,{className:"w-5 h-5 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:"Варианты прикрепления:"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs(d,{variant:"outline",onClick:ee,className:"flex-col h-auto py-3 rounded-xl","data-testid":"button-capture-photo",children:[e.jsx(pe,{className:"w-5 h-5 mb-1"}),e.jsx("span",{className:"text-xs truncate overflow-hidden w-full text-center",children:"Сделать фото"})]}),e.jsxs(d,{variant:"outline",onClick:se,className:"flex-col h-auto py-3 rounded-xl","data-testid":"button-gallery-photo",children:[e.jsx(Q,{className:"w-5 h-5 mb-1"}),e.jsx("span",{className:"text-xs truncate overflow-hidden w-full text-center",children:"Из галереи"})]}),e.jsxs(d,{variant:"outline",onClick:te,className:"flex-col h-auto py-3 rounded-xl","data-testid":"button-upload-document",children:[e.jsx(X,{className:"w-5 h-5 mb-1"}),e.jsx("span",{className:"text-xs truncate overflow-hidden w-full text-center",children:"Документ"})]})]})]}),e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(q,{placeholder:"Вставьте ссылку",value:S,onChange:s=>B(s.target.value),className:"rounded-xl","data-testid":"input-link"}),e.jsx(d,{onClick:re,variant:"outline",className:"rounded-xl shrink-0","data-testid":"button-add-link",children:e.jsx(_,{className:"w-4 h-4"})})]})}),o.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:"Прикреплённые файлы:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:o.map((s,t)=>e.jsxs(m,{className:"flex items-center gap-2 p-2 pr-1 rounded-xl","data-testid":`attachment-${t}`,children:[s.type==="image"&&e.jsx(Q,{className:"w-4 h-4 text-muted-foreground"}),s.type==="link"&&e.jsx(_,{className:"w-4 h-4 text-muted-foreground"}),s.type==="pdf"&&e.jsx(X,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm truncate max-w-[120px]",children:s.name||s.value}),e.jsx(d,{variant:"ghost",size:"icon",className:"h-6 w-6 rounded-full",onClick:()=>de(t),"data-testid":`button-remove-attachment-${t}`,children:e.jsx(fe,{className:"w-3 h-3"})})]},t))})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(d,{onClick:v,variant:"outline",className:"flex-1 rounded-xl",children:"Назад"}),e.jsx(d,{onClick:z,className:"flex-1 rounded-xl","data-testid":"button-next-step",children:"Далее"})]})]})]}),a===4&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Комментарий к заявке (необязательно)"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(ce,{placeholder:"Например: оплатить без чаевых",value:y,onChange:s=>O(s.target.value),rows:3,className:"rounded-xl","data-testid":"input-comment"}),e.jsxs(m,{className:"p-5 bg-muted/30 border-muted rounded-2xl",children:[e.jsx("h3",{className:"font-semibold text-foreground mb-3",children:"Сводка заявки:"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Сумма:"}),e.jsxs("span",{className:"font-semibold text-foreground","data-testid":"text-summary-rub",children:[l.toLocaleString("ru-RU")," ₽"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Будет заморожено:"}),e.jsxs("span",{className:"font-semibold text-foreground","data-testid":"text-summary-usdt",children:[h.toFixed(2)," USDT"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Срочность:"}),e.jsx("span",{className:"font-semibold capitalize text-foreground",children:i==="urgent"?"Срочно":"Стандартно"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Курс:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:[w.toFixed(2)," ₽"]})]}),i==="urgent"&&e.jsx("p",{className:"text-xs text-yellow-600 dark:text-yellow-500 pt-2 border-t font-medium",children:"⚡ Комиссия +0,5%"}),i==="standard"&&e.jsx("p",{className:"text-xs text-green-600 dark:text-green-500 pt-2 border-t font-medium",children:"✓ Без комиссии"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(d,{onClick:v,variant:"outline",className:"flex-1 rounded-xl",children:"Назад"}),e.jsx(d,{onClick:Y,className:"flex-1 rounded-xl","data-testid":"button-submit-payment",children:"Отправить заявку"})]})]})]})]})})}export{Fe as default};
