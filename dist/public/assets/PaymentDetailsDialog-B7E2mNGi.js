import{r as n,j as e}from"./react-vendor-DXh2JWUH.js";import{w as P,x as _,y as k,I as $,z as G,B as D,E as H,F as U,G as V,H as q,S as T,J as A,L as R,K as E}from"./ui-core-DuOrk3UI.js";import{c as u,u as J,y as K,z as O,f}from"./index-XvOZlhht.js";import{g as L,f as Q,h as W,a as X,U as Y,D as Z,C as ee,e as g,E as se,F as ae}from"./icons-vendor-BKMeapAd.js";import{D as te,a as re,b as le,c as ie,A as ne,d as ce,e as de}from"./avatar-nL0TpwiJ.js";import{C as d,a as o,b as m,c as x,B as h}from"./card-l8B5EJfV.js";import{B as S}from"./badge-Dedo9uIt.js";const Ce=P,Se=_,oe=n.forwardRef(({className:l,children:i,...t},c)=>e.jsxs(k,{ref:c,className:u("flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",l),...t,children:[i,e.jsx($,{asChild:!0,children:e.jsx(L,{className:"h-4 w-4 opacity-50"})})]}));oe.displayName=k.displayName;const B=n.forwardRef(({className:l,...i},t)=>e.jsx(T,{ref:t,className:u("flex cursor-default items-center justify-center py-1",l),...i,children:e.jsx(W,{className:"h-4 w-4"})}));B.displayName=T.displayName;const I=n.forwardRef(({className:l,...i},t)=>e.jsx(A,{ref:t,className:u("flex cursor-default items-center justify-center py-1",l),...i,children:e.jsx(L,{className:"h-4 w-4"})}));I.displayName=A.displayName;const me=n.forwardRef(({className:l,children:i,position:t="popper",...c},p)=>e.jsx(G,{children:e.jsxs(D,{ref:p,className:u("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]",t==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",l),position:t,...c,children:[e.jsx(B,{}),e.jsx(H,{className:u("p-1",t==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:i}),e.jsx(I,{})]})}));me.displayName=D.displayName;const xe=n.forwardRef(({className:l,...i},t)=>e.jsx(R,{ref:t,className:u("py-1.5 pl-8 pr-2 text-sm font-semibold",l),...i}));xe.displayName=R.displayName;const ue=n.forwardRef(({className:l,children:i,...t},c)=>e.jsxs(U,{ref:c,className:u("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",l),...t,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(V,{children:e.jsx(Q,{className:"h-4 w-4"})})}),e.jsx(q,{children:i})]}));ue.displayName=U.displayName;const pe=n.forwardRef(({className:l,...i},t)=>e.jsx(E,{ref:t,className:u("-mx-1 my-1 h-px bg-muted",l),...i}));pe.displayName=E.displayName;const he={submitted:"bg-blue-500 text-white",assigned:"bg-purple-500 text-white",processing:"bg-yellow-500 text-black",paid:"bg-green-500 text-white",rejected:"bg-red-500 text-white",cancelled:"bg-gray-400 text-white"},je={submitted:"ОТПРАВЛЕНА",assigned:"НАЗНАЧЕНА",processing:"В ОБРАБОТКЕ",paid:"ОПЛАЧЕНО",rejected:"ОТКЛОНЕНО",cancelled:"ОТМЕНЕНО"};function ke({open:l,onOpenChange:i,paymentId:t,isAdmin:c,adminPassword:p,operatorId:N}){const[s,z]=n.useState(null),[j,w]=n.useState(!1),[v,y]=n.useState(null),{toast:b}=J();n.useEffect(()=>{l&&t&&F()},[l,t]);const F=async()=>{w(!0),y(null);try{let a;if(c&&p)a=await K(p,t);else if(!c&&N)a=await O(N,t);else throw new Error("Missing required parameters");z(a)}catch(a){const r=a instanceof Error?a.message:"Не удалось загрузить детали заявки";y(r),r.includes("Доступ запрещен")?(b({title:"Доступ запрещен",description:"Вы можете просматривать только назначенные вам заявки",variant:"destructive"}),i(!1)):b({title:"Ошибка",description:r,variant:"destructive"})}finally{w(!1)}},C=a=>{if(a.type==="link")window.open(a.value,"_blank");else if(a.type==="image"){const r=document.createElement("a");r.href=a.value,r.download=a.name||"attachment.jpg",r.click()}else{const r=document.createElement("a");r.href=a.value,r.download=a.name||`attachment.${a.type}`,r.click()}},M=(a,r)=>a.type==="image"?e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:a.value,alt:a.name||`Attachment ${r+1}`,className:"max-w-full max-h-64 rounded border object-contain cursor-pointer",onClick:()=>window.open(a.value,"_blank")}),e.jsx(h,{size:"sm",variant:"secondary",className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>C(a),children:e.jsx(g,{className:"w-4 h-4"})})]},r):a.type==="link"?e.jsxs(h,{variant:"outline",className:"w-full justify-start",onClick:()=>window.open(a.value,"_blank"),children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),a.name||a.value]},r):e.jsxs(h,{variant:"outline",className:"w-full justify-start",onClick:()=>C(a),children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),a.name||`${a.type.toUpperCase()} файл`,e.jsx(g,{className:"w-4 h-4 ml-auto"})]},r);return e.jsx(te,{open:l,onOpenChange:i,children:e.jsxs(re,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsx(le,{children:e.jsx(ie,{children:"Детали заявки"})}),j&&e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}),v&&!j&&e.jsxs("div",{className:"flex items-center gap-2 p-4 bg-destructive/10 text-destructive rounded",children:[e.jsx(X,{className:"w-5 h-5"}),e.jsx("p",{children:v})]}),s&&!j&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs(d,{children:[e.jsx(o,{children:e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5"}),"Информация о клиенте"]})}),e.jsxs(x,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(ne,{children:[e.jsx(ce,{src:s.avatarUrl||void 0}),e.jsx(de,{children:s.username.charAt(0).toUpperCase()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.fullName||s.username}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["@",s.username]})]})]}),s.telegramId&&e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Telegram ID:"}),e.jsx("span",{className:"ml-2 font-mono",children:s.telegramId})]})]})]}),e.jsxs(d,{children:[e.jsx(o,{children:e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-5 h-5"}),"Данные платежа"]})}),e.jsxs(x,{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Сумма в рублях"}),e.jsxs("p",{className:"text-xl font-bold",children:[s.amountRub.toLocaleString("ru-RU")," ₽"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Сумма в USDT"}),e.jsxs("p",{className:"text-xl font-bold",children:[s.amountUsdt.toFixed(2)," USDT"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Курс"}),e.jsxs("p",{className:"font-medium",children:[s.frozenRate.toFixed(2)," ₽/USDT"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Срочность"}),e.jsx(S,{variant:s.urgency==="urgent"?"destructive":"secondary",children:s.urgency==="urgent"?"СРОЧНО":"ОБЫЧНАЯ"})]})]}),s.hasUrgentFee&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"* Включена комиссия за срочную обработку"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Статус"}),e.jsx(S,{className:he[s.status]||"bg-muted",children:je[s.status]||s.status.toUpperCase()})]})]})]}),e.jsxs(d,{children:[e.jsx(o,{children:e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-5 h-5"}),"Временная шкала"]})}),e.jsxs(x,{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-primary"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:"Создано"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:f(s.createdAt)})]})]}),s.assignedAt&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:"Назначено"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:f(s.assignedAt)})]})]}),s.completedAt&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${s.status==="paid"?"bg-green-500":"bg-red-500"}`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:"Завершено"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:f(s.completedAt)})]})]}),s.processingTimeMinutes!==null&&e.jsx("div",{className:"mt-2 pt-2 border-t",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Время обработки: ",e.jsxs("span",{className:"font-medium",children:[s.processingTimeMinutes," мин"]})]})})]})]}),s.assignedOperatorLogin&&e.jsxs(d,{children:[e.jsx(o,{children:e.jsx(m,{children:"Назначенный оператор"})}),e.jsx(x,{children:e.jsx("p",{className:"font-medium",children:s.assignedOperatorLogin})})]}),s.comment&&e.jsxs(d,{children:[e.jsx(o,{children:e.jsx(m,{children:"Комментарий клиента"})}),e.jsx(x,{children:e.jsx("p",{className:"whitespace-pre-wrap",children:s.comment})})]}),s.adminComment&&e.jsxs(d,{children:[e.jsx(o,{children:e.jsx(m,{children:"Комментарий администратора"})}),e.jsx(x,{children:e.jsx("p",{className:"whitespace-pre-wrap",children:s.adminComment})})]}),s.attachments&&s.attachments.length>0&&e.jsxs(d,{children:[e.jsx(o,{children:e.jsx(m,{children:"Вложения"})}),e.jsx(x,{className:"space-y-2",children:s.attachments.map((a,r)=>M(a,r))})]}),s.receipt&&e.jsxs(d,{children:[e.jsx(o,{children:e.jsx(m,{children:"Чек оплаты"})}),e.jsx(x,{children:s.receipt.type==="image"?e.jsx("img",{src:s.receipt.value,alt:"Receipt",className:"max-w-full max-h-64 rounded border object-contain"}):e.jsxs(h,{variant:"outline",onClick:()=>window.open(s.receipt.value,"_blank"),children:[e.jsx(g,{className:"w-4 h-4 mr-2"}),"Скачать чек (",s.receipt.name,")"]})})]})]})]})})}export{ke as P,Ce as S,oe as a,Se as b,me as c,ue as d};
