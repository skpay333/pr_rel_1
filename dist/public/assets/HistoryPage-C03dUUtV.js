import{r as u,j as e}from"./react-vendor-DXh2JWUH.js";import{C as g,B as b}from"./card-l8B5EJfV.js";import{B as $}from"./badge-Dedo9uIt.js";import{T as A,a as E,b as j,c as w}from"./tabs-T0-tMZ9B.js";import{u as S}from"./index-XvOZlhht.js";import{C as p,m as H,f as N,X as v,a as F,i as y,E as L,e as P}from"./icons-vendor-BKMeapAd.js";import"./ui-extended-CLSNRB24.js";import"./ui-core-DuOrk3UI.js";import"./utils-vendor-B2rm_Apj.js";import"./react-query-DV86JtqI.js";const z=(a,o,l)=>{const c=a.startsWith("data:")?a:`data:${l};base64,${a}`,t=document.createElement("a");t.href=c,t.download=o,document.body.appendChild(t),t.click(),document.body.removeChild(t)},D={submitted:"bg-blue-500 text-white",assigned:"bg-purple-500 text-white",processing:"bg-yellow-500 text-black",paid:"bg-green-500 text-white",rejected:"bg-red-500 text-white",cancelled:"bg-gray-400 text-white",pending:"bg-yellow-500 text-black",confirmed:"bg-green-500 text-white",expired:"bg-gray-400 text-white"},I={submitted:"ОТПРАВЛЕНА",assigned:"НАЗНАЧЕНА",processing:"В ОБРАБОТКЕ",paid:"ОПЛАЧЕНО",rejected:"ОТКЛОНЕНО",cancelled:"ОТМЕНЕНО",pending:"ОЖИДАНИЕ",confirmed:"ПОДТВЕРЖДЕНО",expired:"ИСТЕКЛО ВРЕМЯ"},U={submitted:F,processing:p,paid:N,rejected:v,cancelled:v,pending:p,confirmed:N,expired:p};function B({expiresAt:a,onExpire:o}){const[l,c]=u.useState(0),[t,h]=u.useState(!1);u.useEffect(()=>{h(!1)},[a]),u.useEffect(()=>{const i=()=>{const x=Date.now(),s=new Date(a).getTime(),r=Math.max(0,Math.floor((s-x)/1e3));c(r),r===0&&!t&&(h(!0),o&&o())};i();const m=setInterval(i,1e3);return()=>clearInterval(m)},[a,t,o]);const d=i=>{const m=Math.floor(i/60),x=i%60;return`${m}:${x.toString().padStart(2,"0")}`};if(l===0)return e.jsx("span",{className:"text-red-600 font-bold text-sm",children:"Истекло"});const f=l<=120;return e.jsxs("div",{className:`flex items-center gap-2 ${f?"text-red-600":"text-green-600"}`,children:[e.jsx(p,{className:"w-4 h-4"}),e.jsx("span",{className:"font-bold text-sm",children:d(l)})]})}function Q({transactions:a,onGoHome:o,onViewRequest:l,onOpenDeposit:c,onRefresh:t}){const{toast:h}=S(),d=a.filter(s=>s.status==="submitted"||s.status==="processing"||s.status==="pending"),f=a.filter(s=>s.status==="paid"||s.status==="rejected"||s.status==="cancelled"||s.status==="confirmed"||s.status==="expired"),i=u.useMemo(()=>d.some(s=>s.type==="deposit"&&s.status==="pending"&&s.expiresAt),[d]);u.useEffect(()=>{if(t&&i){const s=setInterval(()=>{t()},1e4);return()=>clearInterval(s)}},[i,t]);const m=(s,r)=>{navigator.clipboard.writeText(s),h({title:"Скопировано",description:`${r} скопировано в буфер обмена`})},x=s=>{const r=s.type==="deposit",k=s.status==="pending",C=r&&s.payableAmount&&s.expiresAt,T=()=>{r&&c?c(s.id):r||l(s.id)};return e.jsxs(g,{className:"p-6 bg-card shadow-soft cursor-pointer hover-lift transition-soft",onClick:T,"data-testid":`card-transaction-${s.id}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-5",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold uppercase mb-2 text-muted-foreground",children:r?"Пополнение":"Платеж"}),e.jsxs("p",{className:"text-4xl font-bold tabular-nums","data-testid":`text-amount-usdt-${s.id}`,children:[r?"+":"",s.amountUsdt.toFixed(2)," USDT"]})]}),e.jsxs($,{className:`${D[s.status]} rounded-full text-xs font-semibold px-3 py-2 shadow-soft-sm flex items-center gap-2`,"data-testid":`badge-status-${s.id}`,children:[(()=>{const n=U[s.status];return e.jsx(n,{className:"w-4 h-4"})})(),I[s.status]]})]}),e.jsxs("div",{className:"space-y-3 text-sm font-medium border-t border-border pt-4",children:[r?e.jsxs(e.Fragment,{children:[k&&C&&e.jsxs("div",{className:"bg-yellow-50 border-2 border-yellow-400 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-bold text-yellow-900 uppercase",children:"⚡ Активная заявка - нажмите для открытия"}),e.jsx(B,{expiresAt:s.expiresAt,onExpire:t})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("span",{className:"text-2xl font-bold text-yellow-900 font-mono",children:[s.payableAmount.toFixed(2)," USDT"]}),e.jsx(b,{size:"sm",variant:"outline",onClick:n=>{n.stopPropagation(),m(s.payableAmount.toFixed(2),"Сумма")},className:"bg-white border-yellow-500 hover:bg-yellow-50",children:e.jsx(y,{className:"w-4 h-4"})})]}),s.walletAddress&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-bold text-yellow-900",children:"Адрес:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-xs font-mono text-yellow-800 break-all flex-1",children:s.walletAddress}),e.jsx(b,{size:"sm",variant:"outline",onClick:n=>{n.stopPropagation(),m(s.walletAddress,"Адрес")},className:"bg-white border-yellow-500 hover:bg-yellow-50 flex-shrink-0",children:e.jsx(y,{className:"w-4 h-4"})})]})]})]}),s.txHash&&s.status==="confirmed"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-bold text-muted-foreground",children:"Транзакция:"}),e.jsxs("a",{href:`https://tronscan.org/#/transaction/${s.txHash}`,target:"_blank",rel:"noopener noreferrer",onClick:n=>n.stopPropagation(),className:"flex items-center gap-2 text-primary hover:text-primary/80 transition-colors group",children:[e.jsx("span",{className:"text-xs font-mono break-all",children:s.txHash}),e.jsx(L,{className:"w-4 h-4 flex-shrink-0 group-hover:translate-x-0.5 group-hover:-translate-y-0.5 transition-transform"})]})]}),s.txHash&&s.status!=="confirmed"&&e.jsxs("p",{className:"text-xs text-muted-foreground truncate",children:["TX: ",s.txHash.substring(0,10),"...",s.txHash.substring(s.txHash.length-8)]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{"data-testid":`text-amount-rub-${s.id}`,children:[s.amountRub.toLocaleString("ru-RU")," ₽ • ",s.urgency==="urgent"?"Срочно":"Стандартно"]}),e.jsx("div",{children:s.frozenRate&&`${s.frozenRate.toFixed(2)} ₽`}),s.receipt&&e.jsxs(b,{variant:"ghost",size:"sm",className:"flex items-center gap-2 text-green-600 hover:text-green-700 h-auto p-0 font-semibold",onClick:n=>{n.stopPropagation(),z(s.receipt.value,s.receipt.name,s.receipt.mimeType)},children:[e.jsx(P,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs",children:"Скачать чек"})]})]}),e.jsx("div",{"data-testid":`text-date-${s.id}`,children:new Date(s.createdAt).toLocaleString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})})]})]},s.id)};return e.jsx("div",{className:"flex flex-col min-h-[calc(100vh-4rem)] px-6 pt-8 pb-28 bg-background",children:e.jsxs("div",{className:"max-w-md w-full mx-auto space-y-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"История транзакций"}),a.length===0?e.jsx("div",{className:"flex flex-col items-center justify-center py-20",children:e.jsx(g,{className:"p-16 w-full text-center bg-card shadow-soft",children:e.jsxs("div",{className:"space-y-8",children:[e.jsx("h2",{className:"text-4xl font-bold text-foreground",children:"Пусто"}),e.jsx("p",{className:"text-xl font-medium",children:"Заявок нет"}),e.jsx(b,{onClick:o,size:"lg",className:"mt-8 h-14 text-lg",children:"Главная"})]})})}):e.jsxs(A,{defaultValue:"active",className:"w-full",children:[e.jsxs(E,{className:"grid w-full grid-cols-2 bg-card shadow-soft-sm rounded-[18px] p-1 mb-6",children:[e.jsx(j,{value:"active",className:"rounded-[14px] data-[state=active]:bg-accent data-[state=active]:text-accent-foreground data-[state=active]:shadow-soft-sm font-semibold transition-soft",children:"Активные платежи"}),e.jsx(j,{value:"history",className:"rounded-[14px] data-[state=active]:bg-accent data-[state=active]:text-accent-foreground data-[state=active]:shadow-soft-sm font-semibold transition-soft",children:"История"})]}),e.jsx(w,{value:"active",className:"space-y-5 animate-fade-in",children:d.length===0?e.jsx(g,{className:"p-12 text-center bg-card shadow-soft",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(p,{className:"w-12 h-12 mx-auto text-muted-foreground"}),e.jsx("p",{className:"text-base font-medium text-muted-foreground",children:"Нет активных платежей"})]})}):d.map(x)}),e.jsx(w,{value:"history",className:"space-y-5 animate-fade-in",children:f.length===0?e.jsx(g,{className:"p-12 text-center bg-card shadow-soft",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(H,{className:"w-12 h-12 mx-auto text-muted-foreground"}),e.jsx("p",{className:"text-base font-medium text-muted-foreground",children:"История пуста"})]})}):f.map(x)})]})]})})}export{Q as default};
